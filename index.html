<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI LKPD Generator - Fokus Teks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .neon-accent {
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.15);
        }
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #22d3ee;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .prose h1 { color: #22d3ee; font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem; text-align: center; }
        .prose h2 { color: #1e293b; font-size: 1.4rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.25rem; }
        .prose h3 { color: #334155; font-size: 1.1rem; font-weight: 600; margin-top: 1rem; }
        .prose p { margin-bottom: 0.8rem; line-height: 1.6; color: #475569; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; color: #475569; }
        .prose table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.9rem; }
        .prose th, .prose td { border: 1px solid #cbd5e1; padding: 0.75rem; text-align: left; }
        .prose th { background-color: #f1f5f9; font-weight: 600; }
        
        .toolbar-btn {
            @apply flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-10 flex flex-col items-center">
            <div class="bg-gradient-to-r from-cyan-500/20 to-blue-500/20 text-cyan-400 border border-cyan-500/30 px-4 py-1 rounded-full text-xs font-bold tracking-widest mb-4 backdrop-blur-sm">
                AI POWERED EDTECH ✨
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-indigo-500 text-center">
                LKPD AI GENERATOR
            </h1>
            <p class="mt-3 text-slate-400 text-center max-w-xl">
                Sistem penyusunan LKPD otomatis berbasis teks, rubrik penilaian, kuis, dan narasi suara.
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <!-- Form Input -->
            <div class="lg:col-span-4 space-y-4">
                <div class="glass-panel p-6 rounded-3xl neon-accent border-cyan-500/20">
                    <h2 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                        Konfigurasi
                    </h2>

                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Fase</label>
                                <select id="fase" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-white">
                                    <option value="A">Fase A</option>
                                    <option value="B">Fase B</option>
                                    <option value="C">Fase C</option>
                                    <option value="D">Fase D</option>
                                    <option value="E">Fase E</option>
                                    <option value="F">Fase F</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Kelas</label>
                                <input type="text" id="kelas" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-white" placeholder="Cth: 7-A">
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Mata Pelajaran</label>
                            <input type="text" id="mapel" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-white" placeholder="Cth: IPA">
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Materi Pembelajaran</label>
                            <input type="text" id="materi" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-white" placeholder="Cth: Fotosintesis">
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Level Bloom</label>
                            <select id="bloom" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-white">
                                <option value="C1-Mengingat">C1 - Mengingat</option>
                                <option value="C2-Memahami">C2 - Memahami</option>
                                <option value="C3-Menerapkan">C3 - Menerapkan</option>
                                <option value="C4-Menganalisis">C4 - Menganalisis</option>
                                <option value="C5-Mengevaluasi">C5 - Mengevaluasi</option>
                                <option value="C6-Menciptakan">C6 - Menciptakan</option>
                            </select>
                        </div>

                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="block text-[10px] font-bold text-slate-400 uppercase">Tujuan Pembelajaran</label>
                                <button id="btnAutoTujuan" class="text-[10px] bg-cyan-900/50 hover:bg-cyan-800 text-cyan-300 px-3 py-1 rounded-full transition-colors flex items-center gap-1 border border-cyan-700/50">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                    Buat Otomatis
                                </button>
                            </div>
                            <textarea id="tujuan" rows="3" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-white" placeholder="Pilih Bloom dan Materi, lalu klik 'Buat Otomatis'..."></textarea>
                        </div>

                        <button id="btnGenerate" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-3 group shadow-lg shadow-cyan-500/20">
                            <span>GENERATE LKPD</span>
                            <div id="loadingIcon" class="loader hidden"></div>
                            <svg id="sparkleIcon" class="w-5 h-5 group-hover:rotate-12 transition-transform text-yellow-300" fill="currentColor" viewBox="0 0 20 20"><path d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM11 2a1 1 0 011-1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0V4h-1a1 1 0 110-2h1V1a1 1 0 011-1z"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Preview Column -->
            <div class="lg:col-span-8 space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-widest flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-cyan-500 animate-pulse"></span>
                        Live Preview
                    </h3>
                    <button id="btnWord" class="hidden bg-white hover:bg-slate-100 text-slate-900 px-5 py-2 rounded-full text-xs font-bold flex items-center gap-2 transition-transform active:scale-95 shadow-lg">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        DOWNLOAD .DOC
                    </button>
                </div>

                <div id="aiToolbar" class="hidden glass-panel p-2 rounded-2xl flex flex-wrap gap-2 mb-2">
                    <div class="text-xs font-bold text-cyan-400 px-3 py-2 uppercase tracking-wide flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path></svg>
                        Opsi AI:
                    </div>
                    <button id="btnTTS" class="toolbar-btn bg-slate-800 hover:bg-slate-700 text-cyan-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                        Putar Suara
                    </button>
                    <button id="btnRubrik" class="toolbar-btn bg-slate-800 hover:bg-slate-700 text-emerald-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        + Rubrik
                    </button>
                    <button id="btnKuis" class="toolbar-btn bg-slate-800 hover:bg-slate-700 text-purple-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                        + Kuis PG
                    </button>
                </div>

                <div id="previewCard" class="bg-white text-slate-900 rounded-[2rem] p-8 md:p-12 min-h-[700px] shadow-2xl relative overflow-hidden transition-all">
                    <div id="content-area" class="prose max-w-none">
                        <div class="flex flex-col items-center justify-center h-[500px] text-slate-400 text-center">
                            <div class="w-24 h-24 bg-slate-100 rounded-3xl flex items-center justify-center mb-6">
                                <svg class="w-10 h-10 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            </div>
                            <h4 class="text-xl font-semibold text-slate-500 mb-2">Siap Menyusun LKPD</h4>
                            <p class="text-sm max-w-xs mx-auto">Isi konfigurasi di kiri, lalu tekan tombol Generate untuk membuat Lembar Kerja Peserta Didik tanpa ilustrasi gambar.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "";
        const btnGenerate = document.getElementById('btnGenerate');
        const btnWord = document.getElementById('btnWord');
        const contentArea = document.getElementById('content-area');
        const loadingIcon = document.getElementById('loadingIcon');
        const sparkleIcon = document.getElementById('sparkleIcon');
        const aiToolbar = document.getElementById('aiToolbar');
        const btnTTS = document.getElementById('btnTTS');
        const btnRubrik = document.getElementById('btnRubrik');
        const btnKuis = document.getElementById('btnKuis');
        const btnAutoTujuan = document.getElementById('btnAutoTujuan');
        const tujuanTextarea = document.getElementById('tujuan');

        let currentParams = {};
        let isSpeaking = false;
        let audio = null;

        // Fungsi pembersihan teks dari simbol yang tidak diinginkan
        function cleanAiText(text) {
            // Hapus pembungkus markdown code block jika ada
            let cleaned = text.replace(/```html/gi, '').replace(/```/g, '');
            // Hapus simbol $ yang sering muncul di awal/akhir baris karena format LaTeX/Markdown
            cleaned = cleaned.replace(/\$/g, '');
            return cleaned.trim();
        }

        function pcmToWav(pcmData, sampleRate = 24000) {
            const buffer = new ArrayBuffer(44 + pcmData.byteLength);
            const view = new DataView(buffer);
            const writeString = (view, offset, string) => {
                for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i));
            };
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcmData.byteLength, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, pcmData.byteLength, true);
            new Uint8Array(buffer, 44).set(new Uint8Array(pcmData));
            return new Blob([buffer], { type: 'audio/wav' });
        }

        async function generateText(prompt, systemInstruction) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });
                const result = await response.json();
                return cleanAiText(result.candidates[0].content.parts[0].text);
            } catch (err) { return "Gagal menghubungi AI."; }
        }

        async function textToSpeech(text) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: text }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } }
                        }
                    })
                });
                const result = await response.json();
                const base64Audio = result.candidates[0].content.parts[0].inlineData.data;
                const binaryString = atob(base64Audio);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i);
                const wavBlob = pcmToWav(bytes.buffer);
                return URL.createObjectURL(wavBlob);
            } catch (err) { return null; }
        }

        btnAutoTujuan.addEventListener('click', async () => {
            const materi = document.getElementById('materi').value;
            const bloom = document.getElementById('bloom').value;
            if (!materi) { alert("Isi Materi dulu!"); return; }
            btnAutoTujuan.disabled = true;
            btnAutoTujuan.innerText = "⏳...";
            const prompt = `Buatkan 3 tujuan pembelajaran spesifik untuk materi "${materi}" pada level bloom ${bloom}. Berikan poin-poinnya saja. JANGAN GUNAKAN SIMBOL DOLLAR ($).`;
            const text = await generateText(prompt, "Sebutkan tujuan pembelajaran saja tanpa pembuka. Gunakan teks polos, tanpa simbol matematika atau simbol dollar.");
            tujuanTextarea.value = text.trim();
            btnAutoTujuan.disabled = false;
            btnAutoTujuan.innerHTML = `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Buat Otomatis`;
        });

        btnGenerate.addEventListener('click', async () => {
            currentParams = {
                fase: document.getElementById('fase').value,
                kelas: document.getElementById('kelas').value,
                mapel: document.getElementById('mapel').value,
                materi: document.getElementById('materi').value,
                bloom: document.getElementById('bloom').value,
                tujuan: document.getElementById('tujuan').value
            };

            if (!currentParams.materi || !currentParams.tujuan) { alert("Data belum lengkap."); return; }

            btnGenerate.disabled = true;
            loadingIcon.classList.remove('hidden');
            sparkleIcon.classList.add('hidden');
            contentArea.innerHTML = `<div class="flex flex-col items-center justify-center h-[500px]"><div class="loader w-12 h-12 mb-4"></div><p>Menyusun materi...</p></div>`;

            const systemPrompt = `Anda ahli kurikulum Indonesia. Buat LKPD Kurikulum Merdeka TANPA GAMBAR. Gunakan HTML murni (h1, h2, table, ul, li). DILARANG KERAS menggunakan simbol dollar ($) atau sintaks LaTeX. Jika ada simbol matematika, tuliskan dengan teks biasa atau HTML entity. Berikan ID 'ringkasan-materi' pada section ringkasan.`;
            const userPrompt = `Buat LKPD Mapel ${currentParams.mapel}, Materi ${currentParams.materi}, Kelas ${currentParams.kelas}, Tujuan ${currentParams.tujuan}. Pastikan tidak ada karakter $ di dalam output.`;

            const textHtml = await generateText(userPrompt, systemPrompt);
            contentArea.innerHTML = textHtml;
            
            btnWord.classList.remove('hidden');
            aiToolbar.classList.remove('hidden');
            btnGenerate.disabled = false;
            loadingIcon.classList.add('hidden');
            sparkleIcon.classList.remove('hidden');
        });

        btnRubrik.addEventListener('click', async () => {
            btnRubrik.disabled = true;
            const prompt = `Buatkan tabel rubrik penilaian untuk materi ${currentParams.materi}. Format HTML. JANGAN GUNAKAN SIMBOL DOLLAR ($).`;
            const rubricHtml = await generateText(prompt, "Hanya berikan tabel HTML tanpa simbol dollar.");
            const div = document.createElement('div');
            div.innerHTML = `<h2 style="margin-top:40px;">Rubrik Penilaian</h2>` + rubricHtml;
            contentArea.appendChild(div);
            div.scrollIntoView({behavior: "smooth"});
            btnRubrik.innerText = "✅ Ditambahkan";
        });

        btnKuis.addEventListener('click', async () => {
            btnKuis.disabled = true;
            const prompt = `Buatkan 5 soal pilihan ganda materi ${currentParams.materi}. Format HTML. JANGAN GUNAKAN SIMBOL DOLLAR ($).`;
            const quizHtml = await generateText(prompt, "Hanya berikan list HTML tanpa simbol dollar.");
            const div = document.createElement('div');
            div.innerHTML = `<h2 style="margin-top:40px;">Kuis Latihan</h2>` + quizHtml;
            contentArea.appendChild(div);
            div.scrollIntoView({behavior: "smooth"});
            btnKuis.innerText = "✅ Ditambahkan";
        });

        btnTTS.addEventListener('click', async () => {
            if (isSpeaking) { if (audio) audio.pause(); isSpeaking = false; btnTTS.innerText = "Putar Suara"; return; }
            const summaryDiv = document.getElementById('ringkasan-materi');
            const textToRead = summaryDiv ? summaryDiv.innerText : contentArea.innerText.substring(0, 500);
            btnTTS.innerText = "Memuat...";
            const url = await textToSpeech("Ringkasan untuk Anda: " + textToRead);
            if (url) {
                audio = new Audio(url);
                audio.play();
                isSpeaking = true;
                btnTTS.innerText = "⏹️ Stop";
                audio.onended = () => { isSpeaking = false; btnTTS.innerText = "Putar Suara"; };
            }
        });

        btnWord.addEventListener('click', () => {
            const blob = new Blob(['\ufeff', `<html><body>${contentArea.innerHTML}</body></html>`], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `LKPD_${currentParams.materi}.doc`;
            link.click();
        });
    </script>
</body>
</html>